## rollup 打包配置

### rollup.config.js

- 配置入口和出口文件
- 采用 umd 打包方式挂载 global.Vue
- 采用 .babelrc 的 @babel/preset-env 预设插件

### package.json 配置

- 运行 npm run dev 执行 rollup 打包 -c:指定配置文件 -w:监听文件变化

## 初始化数据

### 创建 Vue 构造函数

- 传入用户选项 options
- 调用初始化方法 \_init

### initMixin 扩展 init 方法

- 将用户选项挂载在实例上
- 初始化状态 initState
- initData 初始化 data

## 响应式原理，对象属性劫持

### 创建 Observer 类

- 调用 walk 循环对象，对属性进行劫持
- difineReactive 内使用递归，进行深层属性劫持

### 数据方便使用

- proxy 使用了 defineProperty

- vm.key => vm.\_data.key

## 数组的函数劫持

### 实现数组内对象的劫持

- 用 \_\_ob\_\_ 标记 Observer 类，并且使其变成不可枚举属性，防止 defineProperty 死循环，可以用作标记已观测数组

- 数组不需要全部进行劫持，只需要对数组内对象进行劫持，调用 observeArray 循环监测对象

### 数组变异方法代理

- 创造新数组原型指向旧数组原型 newArrayProto.\_\_proto\_\_ = Array.prototype

- 重写数组变异方法，内部调用原来的方法，对新增的对象数据再次进行劫持

## 模板编译原理

### 原型上绑定 $mount 方法

- 获取用户模板和用户选项，compileToFunction 将模板转换成 render 函数

### parseHTML 生成 AST 语法树

- 采用正则，循环匹配了开始标签，结束标签，标签属性，文本内容

- 匹配一段截掉一段，同时利用栈型结构构建 AST 语法树
